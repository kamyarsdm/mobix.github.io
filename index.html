<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mobix | Ù…ÙˆØ¨ÛŒÚ©Ø³ â€” ØªØ¹Ù…ÛŒØ± Ù…ÙˆØ¨Ø§ÛŒÙ„</title>

  <meta name="description" content="Ù…ÙˆØ¨ÛŒÚ©Ø³Ø› ØªØ¹Ù…ÛŒØ± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ Ø³Ø±ÙˆÛŒØ³ Ú©Ø§Ù…Ù„. Ø¯Ø±ÛŒØ§ÙØª Ú¯ÙˆØ´ÛŒ Ø¨Ø§ Ù¾ÛŒÚ© Ù…ÙˆØ¨ÛŒÚ©Ø³ØŒ ØªØ¹Ù…ÛŒØ± ØªÙˆØ³Ø· ØªØ¹Ù…ÛŒØ±Ú©Ø§Ø±Ø§Ù† Ù…ÙˆØ¨ÛŒÚ©Ø³ Ùˆ ØªØ­ÙˆÛŒÙ„ Ø¨Ù‡ Ø´Ù…Ø§. Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¯Ø§Ø®Ù„ Ø§Ù¾." />

  <meta property="og:title" content="Mobix | Ù…ÙˆØ¨ÛŒÚ©Ø³ â€” ØªØ¹Ù…ÛŒØ± Ù…ÙˆØ¨Ø§ÛŒÙ„" />
  <meta property="og:description" content="ØªØ¹Ù…ÛŒØ± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ Ù¾ÛŒÚ© Ù…ÙˆØ¨ÛŒÚ©Ø³ØŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¯Ø§Ø®Ù„ Ø§Ù¾." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://kamyarsdm.github.io/mobix.github.io/assets/hero.png" />

  <meta name="theme-color" content="#1F6AFF" />
  <link rel="icon" href="assets/logo.png" />

  <!-- Vazirmatn -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#F6F8FC;
      --card:#FFFFFF;
      --text:#0B1220;
      --muted:#5B6B84;
      --line:rgba(15,23,42,.08);

      --shadow: 0 14px 36px rgba(15,23,42,.10);
      --shadow2: 0 8px 18px rgba(15,23,42,.08);

      --radius:20px;

      --primary:#1F6AFF;
      --primary2:#3B82F6;
      --success:#10B981;
      --danger:#EF4444;
      --warn:#F59E0B;

      --max:1160px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:"Vazirmatn", system-ui, sans-serif;
      background:
        radial-gradient(1000px 500px at 80% -10%, rgba(31,106,255,.16), transparent 55%),
        radial-gradient(900px 600px at 20% 10%, rgba(59,130,246,.08), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    a{text-decoration:none;color:inherit}
    img{max-width:100%;display:block}

    .container{max-width:var(--max);margin:auto;padding:14px 16px 96px}

    /* TOP BAR */
    .topbar{
      position:sticky;top:0;z-index:50;
      padding:10px 0;
      backdrop-filter: blur(12px);
    }
    .topbar-inner{
      display:flex;align-items:center;justify-content:space-between;
      background:rgba(246,248,252,.86);
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      box-shadow:var(--shadow2);
      gap:10px;
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .brand img{width:64px;height:auto}
    .brand-title{font-weight:900;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .nav{
      display:flex;align-items:center;gap:8px;flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      padding:9px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.86);
      font-weight:800;
      font-size:13px;
      box-shadow:var(--shadow2);
    }

    .btn{
      padding:10px 16px;
      border-radius:14px;
      font-weight:900;
      border:1px solid var(--line);
      background:#fff;
      box-shadow:var(--shadow2);
      cursor:pointer;
      font-family:inherit;
      white-space:nowrap;
    }
    .btn.primary{
      background:linear-gradient(135deg,var(--primary),var(--primary2));
      color:#fff;
      border:none;
    }
    .btn.ghost{
      background:rgba(255,255,255,.72);
    }
    .btn.danger{
      background:rgba(239,68,68,.10);
      border:1px solid rgba(239,68,68,.25);
      color:#7F1D1D;
    }
    .btn:disabled{opacity:.55;cursor:not-allowed}

    /* HERO */
    .hero{
      margin-top:16px;
      display:grid;
      grid-template-columns:1.1fr .9fr;
      gap:14px;
      align-items:start;
    }
    @media(max-width:980px){.hero{grid-template-columns:1fr}}

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
    }

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(16,185,129,.22);
      background:rgba(16,185,129,.08);
      color:#0B3A2C;
      font-weight:900;
      font-size:13px;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--success);
      box-shadow:0 0 0 6px rgba(16,185,129,.18);
    }

    h1{
      font-size:44px;
      font-weight:900;
      margin:12px 0 8px;
      letter-spacing:-.3px;
    }
    @media(max-width:520px){h1{font-size:34px}}

    .sub{
      color:var(--muted);
      font-size:15.5px;
      line-height:1.85;
      margin:0;
    }

    .cta{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}

    .hero-art{
      margin-top:14px;
      border-radius:20px;
      overflow:hidden;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      background:
        radial-gradient(600px 260px at 70% 0%, rgba(31,106,255,.22), transparent 60%),
        radial-gradient(520px 260px at 10% 40%, rgba(59,130,246,.16), transparent 58%),
        #0B0F1A;
    }
    .hero-art img{width:100%;height:auto}

    .mini-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:14px;
    }
    @media(max-width:520px){.mini-grid{grid-template-columns:1fr}}
    .mini{
      background:linear-gradient(180deg, rgba(31,106,255,.06), rgba(255,255,255,1));
      border:1px solid var(--line);
      border-radius:18px;
      padding:12px 12px;
    }
    .mini .t{font-weight:900}
    .mini .d{color:var(--muted);font-size:13.5px;line-height:1.75;margin-top:6px}

    /* APP PREVIEW */
    .app-wrap{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:10px;
      align-items:stretch;
    }
    @media(max-width:900px){.app-wrap{grid-template-columns:1fr}}

    .mock{
      border:1px solid var(--line);
      border-radius:22px;
      overflow:hidden;
      box-shadow:var(--shadow);
      background:linear-gradient(180deg, rgba(31,106,255,.08), rgba(255,255,255,1));
      position:relative;
      min-height:260px;
    }
    .mock-top{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 14px;
      background:rgba(255,255,255,.86);
      border-bottom:1px solid var(--line);
      gap:10px;
    }
    .mock-top b{font-weight:900}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(31,106,255,.10);
      border:1px solid rgba(31,106,255,.18);
      color:#0B2A6A;
      font-weight:900;
      font-size:12.5px;
      white-space:nowrap;
    }
    .mock-body{padding:14px}
    .step{
      display:flex;gap:10px;align-items:flex-start;
      padding:10px 10px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      margin-bottom:10px;
    }
    .step:last-child{margin-bottom:0}
    .sicon{
      width:34px;height:34px;border-radius:12px;
      background:linear-gradient(135deg, rgba(31,106,255,.22), rgba(59,130,246,.12));
      border:1px solid rgba(31,106,255,.18);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;color:#0B2A6A;
      flex:0 0 auto;
    }
    .stxt b{display:block;font-weight:900}
    .stxt span{display:block;color:var(--muted);font-size:13.5px;line-height:1.7;margin-top:4px}

    .kpi{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media(max-width:520px){.kpi{grid-template-columns:1fr}}
    .kpi .box{
      border:1px solid var(--line);
      background:#fff;
      border-radius:18px;
      padding:12px;
      box-shadow:var(--shadow2);
    }
    .kpi .box b{font-weight:900}
    .kpi .box div{color:var(--muted);font-size:13.5px;line-height:1.7;margin-top:6px}

    /* SECTIONS */
    .section{margin-top:20px}
    .section h2{font-size:20px;font-weight:900;margin:0 0 10px}

    /* WHY */
    .why-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media(max-width:900px){.why-grid{grid-template-columns:1fr}}

    .media{
      background:#fff;
      border-radius:20px;
      border:1px solid var(--line);
      overflow:hidden;
      box-shadow:var(--shadow);
    }
    .media .imgwrap{
      width:100%;
      aspect-ratio: 16 / 9;
      background:
        radial-gradient(560px 240px at 70% 10%, rgba(31,106,255,.18), transparent 60%),
        radial-gradient(520px 240px at 10% 60%, rgba(59,130,246,.12), transparent 58%),
        #0B0F1A;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .media img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
    .media-caption{
      padding:12px 14px;
      font-size:14px;
      color:var(--muted);
      line-height:1.8;
    }
    .media-caption b{color:var(--text)}

    /* HOW IT WORKS */
    .timeline{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
    }
    @media(max-width:980px){.timeline{grid-template-columns:1fr 1fr}}
    @media(max-width:520px){.timeline{grid-template-columns:1fr}}
    .tcard{
      border:1px solid var(--line);
      border-radius:20px;
      background:#fff;
      box-shadow:var(--shadow2);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .tcard:before{
      content:"";
      position:absolute;inset:-60px -60px auto auto;
      width:180px;height:180px;border-radius:999px;
      background:rgba(31,106,255,.08);
      transform:rotate(12deg);
    }
    .tnum{
      width:38px;height:38px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,var(--primary),var(--primary2));
      color:#fff;font-weight:900;
      box-shadow:0 12px 22px rgba(31,106,255,.22);
      position:relative;
    }
    .tcard b{display:block;margin-top:10px;font-weight:900;position:relative}
    .tcard p{margin:6px 0 0;color:var(--muted);font-size:13.5px;line-height:1.8;position:relative}

    /* AUTH + ORDER */
    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      align-items:start;
    }
    @media(max-width:900px){.grid-2{grid-template-columns:1fr}}

    .form{
      margin-top:10px;
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      align-items:center;
    }
    @media(max-width:520px){.form{grid-template-columns:1fr}}

    .input{
      width:100%;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow:var(--shadow2);
      font-family:inherit;
      font-weight:700;
      outline:none;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-top:10px;
    }
    .label{
      font-size:13px;
      font-weight:900;
      color:var(--muted);
    }
    .textarea{
      width:100%;
      min-height:110px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow:var(--shadow2);
      font-family:inherit;
      font-weight:700;
      outline:none;
      resize:vertical;
      line-height:1.9;
    }

    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:13px;
      line-height:1.7;
      white-space:pre-line;
    }

    .status{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.86);
      font-weight:900;
      font-size:12.8px;
    }
    .status.ok{border-color:rgba(16,185,129,.25);background:rgba(16,185,129,.08);color:#0B3A2C}
    .status.err{border-color:rgba(239,68,68,.25);background:rgba(239,68,68,.08);color:#7F1D1D}
    .status.warn{border-color:rgba(245,158,11,.30);background:rgba(245,158,11,.10);color:#78350F}

    .divider{
      height:1px;background:var(--line);
      margin:12px 0;
    }

    .orders{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    .order-item{
      background:#fff;
      border:1px solid var(--line);
      border-radius:18px;
      padding:12px;
      box-shadow:var(--shadow2);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .order-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .order-top b{font-weight:900}
    .muted{color:var(--muted);font-size:13.2px;line-height:1.8}

    .track{
      display:grid;
      grid-template-columns:1fr;
      gap:8px;
      margin-top:4px;
    }
    .track-step{
      display:flex;
      align-items:flex-start;
      gap:10px;
      border:1px solid var(--line);
      background:rgba(246,248,252,.55);
      border-radius:16px;
      padding:10px;
    }
    .track-bullet{
      width:28px;height:28px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      border:1px solid var(--line);
      background:#fff;
      flex:0 0 auto;
    }
    .track-step.done .track-bullet{
      background:rgba(16,185,129,.10);
      border-color:rgba(16,185,129,.25);
      color:#0B3A2C;
    }
    .track-step.active .track-bullet{
      background:rgba(31,106,255,.10);
      border-color:rgba(31,106,255,.25);
      color:#0B2A6A;
    }
    .track-step .tt b{display:block;font-weight:900}
    .track-step .tt span{display:block;color:var(--muted);font-size:13px;line-height:1.8;margin-top:3px}

    /* FLOATING CTA */
    .floating{
      position:fixed;
      left:16px;
      right:16px;
      bottom:14px;
      z-index:60;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .floating-inner{
      width:min(var(--max), 980px);
      pointer-events:auto;
      background:rgba(255,255,255,.86);
      border:1px solid var(--line);
      border-radius:999px;
      box-shadow:var(--shadow);
      padding:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      backdrop-filter: blur(12px);
    }
    .floating-inner .txt{
      display:flex;flex-direction:column;gap:2px;
      min-width:0;
    }
    .floating-inner .txt b{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .floating-inner .txt span{color:var(--muted);font-size:12.8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .floating-inner .actions{display:flex;gap:8px;flex:0 0 auto;flex-wrap:wrap;justify-content:flex-end}

    /* FOOTER */
    .footer{
      margin-top:26px;
      padding-top:14px;
      border-top:1px solid var(--line);
      font-size:13px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* ENAMAD */
    .enamad{
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .enamad img{
      width:110px;
      height:auto;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- HEADER -->
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <img src="assets/logo.png" alt="Mobix">
          <div class="brand-title">Mobix | Ù…ÙˆØ¨ÛŒÚ©Ø³</div>
        </div>

        <div class="nav">
          <a class="chip" href="#why">Ú†Ø±Ø§ Ù…ÙˆØ¨ÛŒÚ©Ø³ØŸ</a>
          <a class="chip" href="#how">Ù…Ø±Ø§Ø­Ù„ Ú©Ø§Ø±</a>
          <a class="chip" href="#order">Ø«Ø¨Øª/Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´</a>
          <button class="btn ghost" id="navAuthBtn" type="button">ÙˆØ±ÙˆØ¯</button>
        </div>
      </div>
    </div>

    <!-- HERO -->
    <section class="hero" id="top">
      <div class="card">
        <span class="badge"><span class="dot"></span> Ù„Ø§Ù†Ú† ØªØ§ Ú†Ù†Ø¯ Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡</span>

        <h1>Ø¨Ø§ Ø®ÛŒØ§Ù„ Ø±Ø§Ø­Øª Ø¨Ø³Ù¾Ø§Ø±ÛŒØ¯</h1>
        <p class="sub">
          Ø¯Ø±ÛŒØ§ÙØª Ú¯ÙˆØ´ÛŒ Ø¨Ø§ <b>Ù¾ÛŒÚ© Ù…ÙˆØ¨ÛŒÚ©Ø³</b>ØŒ ØªØ¹Ù…ÛŒØ± ØªÙˆØ³Ø· <b>ØªØ¹Ù…ÛŒØ±Ú©Ø§Ø±Ø§Ù† Ù…ÙˆØ¨ÛŒÚ©Ø³</b>
          Ùˆ ØªØ­ÙˆÛŒÙ„ Ø¨Ù‡ Ø´Ù…Ø§ Ø¨Ø§ <b>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ</b> Ùˆ <b>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¯Ø§Ø®Ù„ Ø§Ù¾</b>.
        </p>

        <div class="cta">
          <a class="btn primary" href="#order">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†</a>
          <a class="btn ghost" href="#how">Ù…Ø±Ø§Ø­Ù„ Ú©Ø§Ø±</a>
        </div>

        <div class="mini-grid">
          <div class="mini">
            <div class="t">Ø´ÙØ§Ù Ùˆ Ù‚Ø§Ø¨Ù„ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ</div>
            <div class="d">Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡ Ù…Ø´Ø®ØµÙ‡Ø› Ø§Ø² Ø¯Ø±ÛŒØ§ÙØª ØªØ§ ØªØ­ÙˆÛŒÙ„.</div>
          </div>
          <div class="mini">
            <div class="t">Ù‚ÛŒÙ…Øª Ù‚Ø¨Ù„ Ø§Ø² Ø§Ù‚Ø¯Ø§Ù…</div>
            <div class="d">Ù‚Ø¨Ù„ Ø§Ø² Ù‡Ø± Ú©Ø§Ø±ÛŒ Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ø´Ù…Ø§ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ù…ÛŒâ€ŒØ´Ù‡.</div>
          </div>
        </div>

        <div class="hero-art">
          <img src="assets/hero.png" alt="Mobix Hero">
        </div>
      </div>

      <!-- APP PREVIEW -->
      <div class="card">
        <h2 style="margin:0 0 8px;font-weight:900">Ù†Ù…ÙˆÙ†Ù‡ ØªØ¬Ø±Ø¨Ù‡ Ø¯Ø§Ø®Ù„ Ø§Ù¾</h2>
        <p class="sub">Ù‡Ù…ÛŒÙ† Ø´Ú©Ù„ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒ Ú†ÛŒ Ø¯Ø§Ø±Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´Ù‡.</p>

        <div class="app-wrap">
          <div class="mock">
            <div class="mock-top">
              <b>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´</b>
              <span class="pill">ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø­Ø§Ù„ ØªØ¹Ù…ÛŒØ±</span>
            </div>
            <div class="mock-body">
              <div class="step">
                <div class="sicon">1</div>
                <div class="stxt">
                  <b>Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª</b>
                  <span>Ù…Ø´Ø®ØµØ§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ùˆ Ù…Ø´Ú©Ù„ Ø±Ùˆ Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒ.</span>
                </div>
              </div>
              <div class="step">
                <div class="sicon">2</div>
                <div class="stxt">
                  <b>Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§ Ù¾ÛŒÚ©</b>
                  <span>Ù¾ÛŒÚ© Ù…ÙˆØ¨ÛŒÚ©Ø³ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø±Ùˆ ØªØ­ÙˆÛŒÙ„ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡.</span>
                </div>
              </div>
              <div class="step">
                <div class="sicon">3</div>
                <div class="stxt">
                  <b>ØªØ£ÛŒÛŒØ¯ Ù‡Ø²ÛŒÙ†Ù‡</b>
                  <span>Ù‡Ø²ÛŒÙ†Ù‡ Ø¯Ù‚ÛŒÙ‚ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ù‚Ø¯Ø§Ù… Ø¨Ù‡Øª Ø§Ø¹Ù„Ø§Ù… Ù…ÛŒâ€ŒØ´Ù‡.</span>
                </div>
              </div>
              <div class="step">
                <div class="sicon">4</div>
                <div class="stxt">
                  <b>ØªØ­ÙˆÛŒÙ„ Ø¨Ù‡ Ø´Ù…Ø§</b>
                  <span>Ù¾Ø³ Ø§Ø² ØªØ¹Ù…ÛŒØ±ØŒ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø§ Ù¾ÛŒÚ© ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´Ù‡.</span>
                </div>
              </div>
            </div>
          </div>

          <div class="mock">
            <div class="mock-top">
              <b>Ú†Øª Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</b>
              <span class="pill">Ù¾Ø§Ø³Ø® Ø³Ø±ÛŒØ¹</span>
            </div>
            <div class="mock-body">
              <div class="step">
                <div class="sicon">ğŸ’¬</div>
                <div class="stxt">
                  <b>Ú†Øª Ø¯Ø§Ø®Ù„ Ø§Ù¾</b>
                  <span>Ù‡Ø± Ø³Ø¤Ø§Ù„/Ø§Ø¨Ù‡Ø§Ù… Ø¯Ø§Ø´ØªÛŒ Ù‡Ù…ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒÙ¾Ø±Ø³ÛŒ.</span>
                </div>
              </div>
              <div class="step">
                <div class="sicon">ğŸ›¡ï¸</div>
                <div class="stxt">
                  <b>Ú¯Ø²Ø§Ø±Ø´ Ø´ÙØ§Ù</b>
                  <span>Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ùˆ Ù‚Ø·Ø¹Ù‡â€ŒÙ‡Ø§ Ù…Ø´Ø®ØµÙ‡.</span>
                </div>
              </div>
              <div class="step">
                <div class="sicon">âš¡</div>
                <div class="stxt">
                  <b>Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø³Ø±ÛŒØ¹</b>
                  <span>Ø¨Ø±Ø§ÛŒ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù¾ÛŒÚ© Ùˆ ØªØ­ÙˆÛŒÙ„ØŒ Ø³Ø±ÛŒØ¹ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ù…ÛŒâ€ŒØ´Ù‡.</span>
                </div>
              </div>

              <div class="kpi">
                <div class="box">
                  <b>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ</b>
                  <div>Ù…Ø«Ù„ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³ÙØ§Ø±Ø´ØŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ.</div>
                </div>
                <div class="box">
                  <b>Ù‚ÛŒÙ…Øª Ù‚Ø¨Ù„ Ø§Ø² Ú©Ø§Ø±</b>
                  <div>Ø¨Ø¯ÙˆÙ† ØªØ§ÛŒÛŒØ¯ Ø´Ù…Ø§ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ù…ÛŒâ€ŒØ´Ù‡.</div>
                </div>
                <div class="box">
                  <b>Ø³Ø±ÙˆÛŒØ³ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡</b>
                  <div>Ø§Ø² Ø¯Ø±ÛŒØ§ÙØª ØªØ§ ØªØ­ÙˆÛŒÙ„ Ø¨Ø§ ØªÛŒÙ… Ù…ÙˆØ¨ÛŒÚ©Ø³.</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="divider"></div>
        <div id="sessionBadge" class="status warn">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆØ±ÙˆØ¯â€¦</div>
      </div>
    </section>

    <!-- WHY -->
    <section class="section" id="why">
      <h2>Ú†Ø±Ø§ Ù…ÙˆØ¨ÛŒÚ©Ø³ØŸ</h2>
      <div class="why-grid">
        <div class="media">
          <div class="imgwrap">
            <img src="assets/pricing.png" alt="Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ù‚ÛŒÙ…Øª">
          </div>
          <div class="media-caption">
            <b>Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ù‚ÛŒÙ…Øª Ù‚Ø¨Ù„ Ø§Ø² ØªØ¹Ù…ÛŒØ±</b><br>
            Ù‚Ø¨Ù„ Ø§Ø² Ù‡Ø± Ø§Ù‚Ø¯Ø§Ù…ÛŒØŒ Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø§ Ø´Ù…Ø§ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
          </div>
        </div>

        <div class="media">
          <div class="imgwrap">
            <img src="assets/courier.png" alt="Ù¾ÛŒÚ© Ù…ÙˆØ¨ÛŒÚ©Ø³">
          </div>
          <div class="media-caption">
            <b>Ù¾ÛŒÚ© Ø§Ø®ØªØµØ§ØµÛŒ Ù…ÙˆØ¨ÛŒÚ©Ø³</b><br>
            Ø¯Ø±ÛŒØ§ÙØª Ùˆ ØªØ­ÙˆÛŒÙ„ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ø¯Ø±Ø¯Ø³Ø±.
          </div>
        </div>
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="section" id="how">
      <h2>Ù†Ø­ÙˆÙ‡ Ø§Ù†Ø¬Ø§Ù… Ú©Ø§Ø±</h2>
      <div class="timeline">
        <div class="tcard">
          <div class="tnum">1</div>
          <b>Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª</b>
          <p>Ù…Ø¯Ù„ Ú¯ÙˆØ´ÛŒ Ùˆ Ù…Ø´Ú©Ù„ Ø±Ùˆ Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒ ØªØ§ Ø³Ø±ÛŒØ¹ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø´Ù‡.</p>
        </div>
        <div class="tcard">
          <div class="tnum">2</div>
          <b>Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ù¾ÛŒÚ©</b>
          <p>Ø²Ù…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø±Ùˆ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ùˆ Ù¾ÛŒÚ© Ù…ÛŒØ§Ø¯.</p>
        </div>
        <div class="tcard">
          <div class="tnum">3</div>
          <b>Ø§Ø¹Ù„Ø§Ù… Ù‡Ø²ÛŒÙ†Ù‡</b>
          <p>Ø¨Ø¹Ø¯ Ø§Ø² Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒØŒ Ù‡Ø²ÛŒÙ†Ù‡ Ø¯Ù‚ÛŒÙ‚ Ø§Ø¹Ù„Ø§Ù… Ù…ÛŒâ€ŒØ´Ù‡ (Ø¨Ø§ ØªØ§ÛŒÛŒØ¯ Ø´Ù…Ø§).</p>
        </div>
        <div class="tcard">
          <div class="tnum">4</div>
          <b>ØªØ¹Ù…ÛŒØ± Ùˆ ØªØ­ÙˆÛŒÙ„</b>
          <p>ØªØ¹Ù…ÛŒØ± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´Ù‡ Ùˆ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø§ Ù¾ÛŒÚ© Ø¨Ù‡ Ø´Ù…Ø§ ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´Ù‡.</p>
        </div>
      </div>
    </section>

    <!-- ORDER + TRACK -->
    <section class="section" id="order">
      <div class="card">
        <h2 style="margin:0 0 8px;font-weight:900">Ø«Ø¨Øª Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´ (Ù…Ø«Ù„ Ø§Ù¾)</h2>
        <p class="sub">Ø¨Ø§ Edge Function + sms.ir ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯ØŒ Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ú©Ù†ÛŒØ¯.</p>

        <div class="grid-2">

          <!-- AUTH CARD -->
          <div class="card" style="padding:16px;box-shadow:var(--shadow2)">
            <h2 style="margin:0 0 8px;font-weight:900;font-size:18px">ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú©Ø¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ</h2>
            <p class="sub" style="font-size:14.5px">Ú©Ø¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ sms.ir Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯ØŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>

            <div class="field">
              <div class="label">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</div>
              <input id="authPhone" class="input" inputmode="numeric" placeholder="Ù…Ø«Ù„Ø§ 0912xxxxxxx" />
            </div>

            <div class="form">
              <button id="sendOtpBtn" class="btn primary" type="button">Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯</button>
              <div></div>
            </div>

            <div id="otpBox" style="display:none">
              <div class="field">
                <div class="label">Ú©Ø¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ</div>
                <input id="authCode" class="input" inputmode="numeric" placeholder="Ú©Ø¯ Û¶ Ø±Ù‚Ù…ÛŒ" />
              </div>
              <div class="form">
                <button id="verifyOtpBtn" class="btn primary" type="button">ØªØ§ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯</button>
                <button id="logoutBtn" class="btn danger" type="button" style="display:none">Ø®Ø±ÙˆØ¬</button>
              </div>
            </div>

            <div id="authMsg" class="hint" aria-live="polite"></div>

            <div class="divider"></div>

            <div class="muted">
              Ù†Ú©ØªÙ‡: Ú†ÙˆÙ† Phone Auth Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Supabase Ø®Ø§Ù…ÙˆØ´ Ø§Ø³ØªØŒ ÙˆØ±ÙˆØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ Edge Function Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¨Ø§ÛŒØ¯
              Ø¯Ø± Ù¾Ø§Ø³Ø® verifyØŒ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ session Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´ÙˆÙ†Ø¯ (access_token Ùˆ refresh_token) ØªØ§ Ø³Ø§ÛŒØª Ø¨ØªÙˆØ§Ù†Ø¯ Ø³Ø´Ù† Ø±Ø§ Ø³Øª Ú©Ù†Ø¯.
            </div>
          </div>

          <!-- ORDER CARD -->
          <div class="card" style="padding:16px;box-shadow:var(--shadow2)">
            <div class="order-top">
              <h2 style="margin:0;font-weight:900;font-size:18px">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</h2>
              <span id="orderGate" class="status warn">Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</span>
            </div>

            <div id="orderFormWrap" style="display:none">
              <div class="field">
                <div class="label">Ù…Ø¯Ù„ Ú¯ÙˆØ´ÛŒ</div>
                <input id="deviceModel" class="input" placeholder="Ù…Ø«Ù„Ø§ iPhone 13 / Galaxy A52" />
              </div>

              <div class="field">
                <div class="label">Ù…Ø´Ú©Ù„ Ø¯Ø³ØªÚ¯Ø§Ù‡</div>
                <textarea id="problemDesc" class="textarea" placeholder="Ù…Ø«Ù„Ø§ Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯Ù‡ / Ø´Ú©Ø³ØªÚ¯ÛŒ Ø§Ù„â€ŒØ³ÛŒâ€ŒØ¯ÛŒ / Ù…Ø´Ú©Ù„ Ø´Ø§Ø±Ú˜ ..."></textarea>
              </div>

              <div class="field">
                <div class="label">Ø¢Ø¯Ø±Ø³ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§ Ù¾ÛŒÚ©</div>
                <textarea id="address" class="textarea" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ + Ù¾Ù„Ø§Ú© + ÙˆØ§Ø­Ø¯"></textarea>
              </div>

              <div class="field">
                <div class="label">Ø²Ù…Ø§Ù† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª</div>
                <input id="pickupTime" class="input" placeholder="Ù…Ø«Ù„Ø§ Ø§Ù…Ø±ÙˆØ² Û±Û¸ ØªØ§ Û²Û° / ÙØ±Ø¯Ø§ ØµØ¨Ø­" />
              </div>

              <div class="form">
                <button id="createOrderBtn" class="btn primary" type="button">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
                <button id="refreshOrdersBtn" class="btn ghost" type="button">Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
              </div>

              <div id="orderMsg" class="hint" aria-live="polite"></div>
            </div>

            <div class="divider"></div>

            <div class="order-top">
              <h2 style="margin:0;font-weight:900;font-size:18px">Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
              <span id="ordersCount" class="status">0</span>
            </div>

            <div id="ordersWrap" class="orders">
              <div class="muted">Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯ØŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <div class="footer">
      <span>Â© Mobix</span>

      <div class="enamad">
        <a referrerpolicy="origin" target="_blank" href="https://trustseal.enamad.ir/?id=695372&Code=DiznrIm0BJGpnPrtdWijxsgtOlPs8Aqf">
          <img referrerpolicy="origin" src="https://trustseal.enamad.ir/logo.aspx?id=695372&Code=DiznrIm0BJGpnPrtdWijxsgtOlPs8Aqf" alt="Ø§ÛŒÙ†Ù…Ø§Ø¯" style="cursor:pointer" code="DiznrIm0BJGpnPrtdWijxsgtOlPs8Aqf">
        </a>
      </div>

      <span>mobix.github.io</span>
    </div>

  </div>

  <!-- Floating CTA -->
  <div class="floating" role="navigation" aria-label="CTA">
    <div class="floating-inner">
      <div class="txt">
        <b>Ù…ÙˆØ¨ÛŒÚ©Ø³ â€” ØªØ¹Ù…ÛŒØ± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ Ø³Ø±ÙˆÛŒØ³ Ú©Ø§Ù…Ù„</b>
        <span>Ù¾ÛŒÚ©ØŒ ØªØ¹Ù…ÛŒØ±ØŒ ØªØ­ÙˆÛŒÙ„ + Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ø¯Ø§Ø®Ù„ Ø§Ù¾</span>
      </div>
      <div class="actions">
        <a class="btn ghost" href="#how">Ù…Ø±Ø§Ø­Ù„</a>
        <a class="btn ghost" href="#order">Ø«Ø¨Øª/Ù¾ÛŒÚ¯ÛŒØ±ÛŒ</a>
        <button class="btn primary" id="floatingAuthBtn" type="button">ÙˆØ±ÙˆØ¯</button>
      </div>
    </div>
  </div>

  <!-- Supabase JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    (function(){
      // =========================
      // âœ… Supabase Config (yours)
      // =========================
      const SUPABASE_URL = "https://vrxfhfknmxmeatnfzpcg.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyeGZoZmtubXhtZWF0bmZ6cGNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTg2MjksImV4cCI6MjA4MTgzNDYyOX0.iANOG9-g9GnVl58KDYI0A-oYNwfbL3oh2NBddZ2sLLs";

      // âœ… Edge Functions (sms.ir)
      const OTP_REQUEST_URL = "https://vrxfhfknmxmeatnfzpcg.supabase.co/functions/v1/request-otp";
      const OTP_VERIFY_URL  = "https://vrxfhfknmxmeatnfzpcg.supabase.co/functions/v1/verify-otp";

      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // =========================
      // Helpers
      // =========================
      function normalizeDigits(s){
        return (s || "")
          .replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d))
          .replace(/[^\d]/g, "");
      }

      function isValidIranMobile(d){
        if(!d) return false;
        if(d.length === 11 && d.startsWith("09")) return true;
        if(d.length === 10 && d.startsWith("9")) return true;
        return false;
      }

      function toE164Iran(d){
        if(!d) return null;
        if(d.length === 11 && d.startsWith("09")) return "+98" + d.slice(1);
        if(d.length === 10 && d.startsWith("9")) return "+98" + d;
        return null;
      }

      function fmtDate(iso){
        try{
          const dt = new Date(iso);
          if(isNaN(dt.getTime())) return iso || "";
          return dt.toLocaleString("fa-IR", { year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
        }catch(e){ return iso || ""; }
      }

      function esc(s){
        return (s ?? "").toString()
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      async function safeJson(res){
        try{ return await res.json(); }catch(e){ return null; }
      }

      function extractErrorMessage(obj){
        if(!obj) return null;
        if(typeof obj === "string") return obj;
        return obj.message || obj.error || (obj.errors && obj.errors[0] && (obj.errors[0].message || obj.errors[0])) || null;
      }

      // =========================
      // UI Elements
      // =========================
      const navAuthBtn = document.getElementById("navAuthBtn");
      const floatingAuthBtn = document.getElementById("floatingAuthBtn");

      const sessionBadge = document.getElementById("sessionBadge");

      const authPhone = document.getElementById("authPhone");
      const authCode = document.getElementById("authCode");
      const sendOtpBtn = document.getElementById("sendOtpBtn");
      const verifyOtpBtn = document.getElementById("verifyOtpBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const otpBox = document.getElementById("otpBox");
      const authMsg = document.getElementById("authMsg");

      const orderGate = document.getElementById("orderGate");
      const orderFormWrap = document.getElementById("orderFormWrap");
      const deviceModel = document.getElementById("deviceModel");
      const problemDesc = document.getElementById("problemDesc");
      const address = document.getElementById("address");
      const pickupTime = document.getElementById("pickupTime");
      const createOrderBtn = document.getElementById("createOrderBtn");
      const refreshOrdersBtn = document.getElementById("refreshOrdersBtn");
      const orderMsg = document.getElementById("orderMsg");

      const ordersWrap = document.getElementById("ordersWrap");
      const ordersCount = document.getElementById("ordersCount");

      // =========================
      // State
      // =========================
      let lastE164Phone = null;

      // =========================
      // UI functions
      // =========================
      function setStatus(el, type, text){
        el.classList.remove("ok","err","warn");
        if(type) el.classList.add(type);
        el.textContent = text;
      }

      function setMsg(el, type, text){
        if(!text){
          el.textContent = "";
          el.style.color = "var(--muted)";
          return;
        }
        if(type === "ok") el.style.color = "var(--success)";
        else if(type === "err") el.style.color = "var(--danger)";
        else if(type === "warn") el.style.color = "var(--warn)";
        else el.style.color = "var(--muted)";
        el.textContent = text;
      }

      function showAuthBox(show){
        otpBox.style.display = show ? "" : "none";
      }

      function setLoggedInUI(user){
        const loggedIn = !!user;

        if(loggedIn){
          setStatus(sessionBadge, "ok", "ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯ âœ…");
          navAuthBtn.textContent = "Ø­Ø³Ø§Ø¨ Ù…Ù†";
          floatingAuthBtn.textContent = "Ø­Ø³Ø§Ø¨ Ù…Ù†";
          logoutBtn.style.display = "";
          orderFormWrap.style.display = "";
          setStatus(orderGate, "ok", "Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯");
        }else{
          setStatus(sessionBadge, "warn", "ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯");
          navAuthBtn.textContent = "ÙˆØ±ÙˆØ¯";
          floatingAuthBtn.textContent = "ÙˆØ±ÙˆØ¯";
          logoutBtn.style.display = "none";
          orderFormWrap.style.display = "none";
          setStatus(orderGate, "warn", "Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯");
          ordersWrap.innerHTML = '<div class="muted">Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯ØŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>';
          ordersCount.textContent = "0";
        }
      }

      function scrollToOrder(){
        const el = document.getElementById("order");
        if(el) el.scrollIntoView({ behavior:"smooth", block:"start" });
      }

      navAuthBtn.addEventListener("click", function(){
        scrollToOrder();
        authPhone.focus();
      });
      floatingAuthBtn.addEventListener("click", function(){
        scrollToOrder();
        authPhone.focus();
      });

      // =========================
      // Tracking UI mapping
      // =========================
      const TRACK_STEPS = [
        { key:"requested", title:"Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª", desc:"Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯ Ùˆ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³Øª." },
        { key:"picked_up", title:"Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§ Ù¾ÛŒÚ©", desc:"Ù¾ÛŒÚ© Ù…ÙˆØ¨ÛŒÚ©Ø³ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯." },
        { key:"quoted", title:"Ø§Ø¹Ù„Ø§Ù…/ØªØ£ÛŒÛŒØ¯ Ù‡Ø²ÛŒÙ†Ù‡", desc:"Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø¹Ù„Ø§Ù… Ø´Ø¯ Ùˆ Ù…Ù†ØªØ¸Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ù…Ø§Ø³Øª." },
        { key:"repairing", title:"Ø¯Ø± Ø­Ø§Ù„ ØªØ¹Ù…ÛŒØ±", desc:"ØªÚ©Ù†Ø³ÛŒÙ† Ù…ÙˆØ¨ÛŒÚ©Ø³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… ØªØ¹Ù…ÛŒØ± Ø§Ø³Øª." },
        { key:"delivering", title:"Ø§Ø±Ø³Ø§Ù„ Ø¨Ø±Ø§ÛŒ ØªØ­ÙˆÛŒÙ„", desc:"Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ù…Ø³ÛŒØ± ØªØ­ÙˆÛŒÙ„ Ø§Ø³Øª." },
        { key:"delivered", title:"ØªØ­ÙˆÛŒÙ„ Ø¨Ù‡ Ø´Ù…Ø§", desc:"Ø¯Ø³ØªÚ¯Ø§Ù‡ ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯ âœ…" }
      ];

      function normalizeStatus(raw){
        const s = (raw || "").toString().trim().toLowerCase();
        if(["new","created","request","requested","pending"].includes(s)) return "requested";
        if(["pickup","pickedup","picked_up","courier_pickup"].includes(s)) return "picked_up";
        if(["quote","quoted","price","awaiting_approval","approved_pending"].includes(s)) return "quoted";
        if(["repair","repairing","in_repair","fixing"].includes(s)) return "repairing";
        if(["deliver","delivering","shipping","on_the_way"].includes(s)) return "delivering";
        if(["done","delivered","completed","complete"].includes(s)) return "delivered";
        return s || "requested";
      }

      function stepIndex(key){
        const idx = TRACK_STEPS.findIndex(x => x.key === key);
        return idx < 0 ? 0 : idx;
      }

      function renderTrack(statusKey){
        const norm = normalizeStatus(statusKey);
        const activeIdx = stepIndex(norm);

        return `
          <div class="track">
            ${TRACK_STEPS.map((s, i) => {
              const cls = i < activeIdx ? "done" : (i === activeIdx ? "active" : "");
              const bullet = i < activeIdx ? "âœ“" : (i === activeIdx ? "â€¢" : (i+1));
              return `
                <div class="track-step ${cls}">
                  <div class="track-bullet">${bullet}</div>
                  <div class="tt">
                    <b>${esc(s.title)}</b>
                    <span>${esc(s.desc)}</span>
                  </div>
                </div>
              `;
            }).join("")}
          </div>
        `;
      }

      // =========================
      // Supabase actions
      // =========================
      async function refreshSession(){
        const { data, error } = await supabase.auth.getSession();
        if(error){
          setStatus(sessionBadge, "err", "Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙØªÙ† Ø³Ø´Ù†");
          setLoggedInUI(null);
          return null;
        }
        const user = data?.session?.user || null;
        setLoggedInUI(user);
        if(user) await loadOrders();
        return user;
      }

      // =========================
      // âœ… Edge Function OTP (sms.ir)
      // =========================
      async function requestOtpEdge(e164Phone){
        const res = await fetch(OTP_REQUEST_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "apikey": SUPABASE_ANON_KEY,
            "Authorization": "Bearer " + SUPABASE_ANON_KEY
          },
          body: JSON.stringify({ phone: e164Phone })
        });
        const json = await safeJson(res);
        if(!res.ok){
          const msg = extractErrorMessage(json) || ("HTTP " + res.status);
          throw new Error(msg);
        }
        return json || { ok: true };
      }

      async function verifyOtpEdgeAndSetSession(e164Phone, token){
        const res = await fetch(OTP_VERIFY_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "apikey": SUPABASE_ANON_KEY,
            "Authorization": "Bearer " + SUPABASE_ANON_KEY
          },
          body: JSON.stringify({ phone: e164Phone, token })
        });
        const json = await safeJson(res);
        if(!res.ok){
          const msg = extractErrorMessage(json) || ("HTTP " + res.status);
          throw new Error(msg);
        }

        // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ Ø¯Ø± Ù‡Ø± Ø³Ø§Ø®ØªØ§Ø±ÛŒ
        const access_token =
          json?.access_token ||
          json?.session?.access_token ||
          json?.data?.session?.access_token ||
          json?.data?.access_token ||
          json?.tokens?.access_token ||
          null;

        const refresh_token =
          json?.refresh_token ||
          json?.session?.refresh_token ||
          json?.data?.session?.refresh_token ||
          json?.data?.refresh_token ||
          json?.tokens?.refresh_token ||
          null;

        if(!access_token || !refresh_token){
          throw new Error("Ù¾Ø§Ø³Ø® verify Ø´Ø§Ù…Ù„ access_token/refresh_token Ù†Ø¨ÙˆØ¯. (Ø³Ø§Ø®ØªØ§Ø± Ø®Ø±ÙˆØ¬ÛŒ Edge Function Ø±Ø§ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø³Ø§ÛŒØª Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ú©Ù†ÛŒÙ…)");
        }

        const { error } = await supabase.auth.setSession({ access_token, refresh_token });
        if(error) throw new Error(error.message || "Ø®Ø·Ø§ Ø¯Ø± setSession");

        return json;
      }

      async function sendOtp(){
        setMsg(authMsg, "", "");
        const d = normalizeDigits(authPhone.value);
        if(!isValidIranMobile(d)){
          setMsg(authMsg, "err", "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ø±Ø³Øª Ù†ÛŒØ³Øª. Ù…Ø«Ù„ 0912xxxxxxx ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          return;
        }
        const e164 = toE164Iran(d);
        if(!e164){
          setMsg(authMsg, "err", "Ø´Ù…Ø§Ø±Ù‡ Ù‚Ø§Ø¨Ù„ ØªØ¨Ø¯ÛŒÙ„ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.");
          return;
        }

        sendOtpBtn.disabled = true;
        setMsg(authMsg, "warn", "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯â€¦");

        try{
          await requestOtpEdge(e164);
          lastE164Phone = e164;
          showAuthBox(true);
          setMsg(authMsg, "ok", "Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ âœ… Ø­Ø§Ù„Ø§ Ú©Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          authCode.focus();
        }catch(err){
          setMsg(authMsg, "err", "Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯: " + (err?.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"));
          showAuthBox(false);
        }finally{
          sendOtpBtn.disabled = false;
        }
      }

      async function verifyOtp(){
        setMsg(authMsg, "", "");
        const code = normalizeDigits(authCode.value);

        if(!lastE164Phone){
          setMsg(authMsg, "err", "Ø§ÙˆÙ„ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ú©Ø¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.");
          return;
        }
        if(!code || code.length < 4){
          setMsg(authMsg, "err", "Ú©Ø¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ Ø±Ø§ Ø¯Ø±Ø³Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          return;
        }

        verifyOtpBtn.disabled = true;
        setMsg(authMsg, "warn", "Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÛŒØ¯ Ú©Ø¯â€¦");

        try{
          await verifyOtpEdgeAndSetSession(lastE164Phone, code);
          authCode.value = "";
          setMsg(authMsg, "ok", "ÙˆØ±ÙˆØ¯ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ âœ…");
          await refreshSession();
        }catch(err){
          setMsg(authMsg, "err", "ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯: " + (err?.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"));
        }finally{
          verifyOtpBtn.disabled = false;
        }
      }

      async function logout(){
        setMsg(authMsg, "", "");
        const { error } = await supabase.auth.signOut();
        if(error){
          setMsg(authMsg, "err", "Ø®Ø±ÙˆØ¬ Ù†Ø§Ù…ÙˆÙÙ‚: " + (error.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"));
          return;
        }
        lastE164Phone = null;
        showAuthBox(false);
        setMsg(authMsg, "ok", "Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯.");
        await refreshSession();
      }

      async function createOrder(){
        setMsg(orderMsg, "", "");
        const user = (await supabase.auth.getUser()).data?.user;
        if(!user){
          setMsg(orderMsg, "err", "Ø§ÙˆÙ„ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.");
          return;
        }

        const dm = (deviceModel.value || "").trim();
        const pr = (problemDesc.value || "").trim();
        const ad = (address.value || "").trim();
        const pt = (pickupTime.value || "").trim();

        if(!dm || !pr || !ad){
          setMsg(orderMsg, "err", "Ù…Ø¯Ù„ Ú¯ÙˆØ´ÛŒØŒ Ù…Ø´Ú©Ù„ Ùˆ Ø¢Ø¯Ø±Ø³ Ø±Ø§ Ú©Ø§Ù…Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
          return;
        }

        createOrderBtn.disabled = true;
        setMsg(orderMsg, "warn", "Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´â€¦");

        const payload = {
          user_id: user.id,
          customer_phone: user.phone || lastE164Phone,
          device_model: dm,
          problem: pr,
          address: ad,
          pickup_time: pt || null,
          status: "requested"
        };

        const { error } = await supabase
          .from("orders")
          .insert(payload)
          .select("*")
          .single();

        createOrderBtn.disabled = false;

        if(error){
          setMsg(orderMsg, "err", "Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯: " + (error.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"));
          return;
        }

        setMsg(orderMsg, "ok", "Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯ âœ…");
        deviceModel.value = "";
        problemDesc.value = "";
        address.value = "";
        pickupTime.value = "";

        await loadOrders();
      }

      async function loadOrders(){
        const user = (await supabase.auth.getUser()).data?.user;
        if(!user){
          ordersCount.textContent = "0";
          return;
        }

        ordersWrap.innerHTML = '<div class="muted">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§â€¦</div>';

        let res = await supabase
          .from("orders")
          .select("*")
          .eq("user_id", user.id)
          .order("created_at", { ascending:false });

        if(res.error){
          const phone = user.phone || lastE164Phone;
          if(phone){
            res = await supabase
              .from("orders")
              .select("*")
              .eq("customer_phone", phone)
              .order("created_at", { ascending:false });
          }
        }

        if(res.error){
          ordersWrap.innerHTML = `
            <div class="status err">Ø®ÙˆØ§Ù†Ø¯Ù† Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</div>
            <div class="hint" style="color:var(--danger)">${esc(res.error.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ")}</div>
          `;
          ordersCount.textContent = "0";
          return;
        }

        const list = res.data || [];
        ordersCount.textContent = String(list.length);

        if(list.length === 0){
          ordersWrap.innerHTML = '<div class="muted">Ù‡Ù†ÙˆØ² Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</div>';
          return;
        }

        ordersWrap.innerHTML = list.map(o => {
          const id = o.id ?? o.order_id ?? "";
          const created = o.created_at ? fmtDate(o.created_at) : "";
          const st = o.status ?? o.state ?? "requested";
          const dm = o.device_model ?? o.model ?? "";
          const pr = o.problem ?? o.issue ?? "";
          const ad = o.address ?? "";
          const pt = o.pickup_time ?? o.pickup_at ?? "";

          return `
            <div class="order-item">
              <div class="order-top">
                <b>Ø³ÙØ§Ø±Ø´ #${esc(id)}</b>
                <span class="pill">ÙˆØ¶Ø¹ÛŒØª: ${esc(normalizeStatus(st))}</span>
              </div>
              <div class="muted">
                <b>Ù…Ø¯Ù„:</b> ${esc(dm)}<br>
                <b>Ù…Ø´Ú©Ù„:</b> ${esc(pr)}<br>
                <b>Ø¢Ø¯Ø±Ø³:</b> ${esc(ad)}${pt ? `<br><b>Ø²Ù…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª:</b> ${esc(pt)}` : ""}${created ? `<br><b>Ø«Ø¨Øª:</b> ${esc(created)}` : ""}
              </div>
              ${renderTrack(st)}
            </div>
          `;
        }).join("");
      }

      // =========================
      // Events
      // =========================
      const navAuthBtnEl = document.getElementById("navAuthBtn");
      const floatingAuthBtnEl = document.getElementById("floatingAuthBtn");
      navAuthBtnEl.addEventListener("click", function(){ scrollToOrder(); authPhone.focus(); });
      floatingAuthBtnEl.addEventListener("click", function(){ scrollToOrder(); authPhone.focus(); });

      sendOtpBtn.addEventListener("click", sendOtp);
      verifyOtpBtn.addEventListener("click", verifyOtp);
      logoutBtn.addEventListener("click", logout);

      createOrderBtn.addEventListener("click", createOrder);
      refreshOrdersBtn.addEventListener("click", loadOrders);

      supabase.auth.onAuthStateChange((_event, _session) => {
        refreshSession();
      });

      refreshSession();
    })();
  </script>
</body>
</html>
